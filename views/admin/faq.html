<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" sizes="192x192" href="/assets/img/favicon.png">
  <title>Preguntas Frecuentes - Cerberus</title>
  <link rel="stylesheet" href="/assets/css/styles.css"/>
  <link rel="stylesheet" href="/assets/css/admin.css"/>
  <style>
    .admin-container { max-width: 900px; margin: 0 auto; padding: 20px; }
    .page-header { text-align: center; margin-bottom: 30px; }
    .page-title { font-size: 28px; font-weight: 700; color: #fff; margin-bottom: 8px; }
    .page-subtitle { color: rgba(255,255,255,0.5); }

    .search-box {
      margin-bottom: 24px;
      position: relative;
    }
    .search-input {
      width: 100%; padding: 14px 20px 14px 45px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px; color: #fff; font-size: 15px;
    }
    .search-input::placeholder { color: rgba(255,255,255,0.4); }
    .search-icon {
      position: absolute; left: 16px; top: 50%; transform: translateY(-50%);
      color: rgba(255,255,255,0.4); font-size: 18px;
    }

    .category-tabs {
      display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 24px;
      justify-content: center;
    }
    .category-tab {
      padding: 8px 16px; border-radius: 20px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.6);
      font-size: 13px; cursor: pointer; transition: all 0.2s;
    }
    .category-tab:hover { border-color: rgba(255,122,24,0.3); color: #fff; }
    .category-tab.active {
      background: rgba(255,122,24,0.15);
      border-color: rgba(255,122,24,0.4);
      color: #FF7A18;
    }

    .faq-item {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .faq-question {
      padding: 18px 20px;
      font-size: 15px; font-weight: 600; color: #fff;
      cursor: pointer;
      display: flex; justify-content: space-between; align-items: center;
      transition: background 0.2s;
    }
    .faq-question:hover { background: rgba(255,255,255,0.02); }
    .faq-arrow {
      font-size: 12px; color: rgba(255,255,255,0.4);
      transition: transform 0.2s;
    }
    .faq-item.open .faq-arrow { transform: rotate(180deg); }
    .faq-answer {
      padding: 0 20px;
      max-height: 0; overflow: hidden;
      transition: all 0.3s ease;
    }
    .faq-item.open .faq-answer {
      padding: 0 20px 20px;
      max-height: 500px;
    }
    .faq-answer-content {
      color: rgba(255,255,255,0.7);
      line-height: 1.7; font-size: 14px;
      border-top: 1px solid rgba(255,255,255,0.06);
      padding-top: 16px;
    }
    .faq-answer-content p { margin-bottom: 12px; }
    .faq-answer-content ul, .faq-answer-content ol { margin-left: 20px; margin-bottom: 12px; }
    .faq-answer-content strong { color: #fff; }
    .faq-answer-content code {
      background: rgba(255,122,24,0.1);
      padding: 2px 6px; border-radius: 4px;
      color: #FF7A18; font-size: 13px;
    }

    .empty-state { text-align: center; padding: 60px; color: rgba(255,255,255,0.5); }
    .no-results { text-align: center; padding: 40px; color: rgba(255,255,255,0.4); }
  </style>
</head>
<body>
  <main class="admin-wrap">
    <div class="admin-bg"></div>
    <header class="admin-top">
      <div class="dashboard-header">
        <div class="header-logo"><img src="/assets/img/cerberus-mark.png" alt="Cerberus"></div>
        <div class="admin-brand">
          <div class="admin-title">Centro de Ayuda</div>
          <div class="admin-sub">Preguntas frecuentes</div>
        </div>
        <div class="header-right">
          <a class="btn btn--ghost" href="./portal">Volver al Portal</a>
        </div>
      </div>
    </header>

    <div class="admin-container">
      <div class="page-header">
        <div class="page-title">Preguntas Frecuentes</div>
        <div class="page-subtitle">Encuentra respuestas a las preguntas mas comunes</div>
      </div>

      <div class="search-box">
        <span class="search-icon">&#x1F50D;</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Buscar pregunta...">
      </div>

      <div class="category-tabs" id="categoryTabs">
        <button class="category-tab active" data-category="all">Todas</button>
      </div>

      <div id="faqList">
        <div class="empty-state">Cargando...</div>
      </div>
    </div>
  </main>

  <script>
    let faqs = [];
    let currentCategory = 'all';
    let searchQuery = '';

    const categoryLabels = {
      general: 'General',
      storage: 'Almacenamiento',
      support: 'Soporte',
      billing: 'Facturacion',
      technical: 'Tecnico'
    };

    async function loadFaqs() {
      try {
        const res = await fetch('./api/faq');
        const data = await res.json();
        faqs = data.faqs || [];
        buildCategoryTabs();
        renderFaqs();
      } catch (err) {
        console.error(err);
      }
    }

    function buildCategoryTabs() {
      const categories = [...new Set(faqs.map(f => f.category))];
      const tabs = document.getElementById('categoryTabs');
      tabs.innerHTML = '<button class="category-tab active" data-category="all">Todas</button>';

      categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-tab';
        btn.dataset.category = cat;
        btn.textContent = categoryLabels[cat] || cat;
        tabs.appendChild(btn);
      });

      tabs.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentCategory = tab.dataset.category;
          renderFaqs();
        });
      });
    }

    function renderFaqs() {
      const container = document.getElementById('faqList');
      let filtered = faqs;

      if (currentCategory !== 'all') {
        filtered = filtered.filter(f => f.category === currentCategory);
      }

      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        filtered = filtered.filter(f =>
          f.question.toLowerCase().includes(q) ||
          f.answer.toLowerCase().includes(q)
        );
      }

      if (filtered.length === 0) {
        container.innerHTML = searchQuery
          ? '<div class="no-results">No se encontraron resultados para tu busqueda</div>'
          : '<div class="empty-state">No hay preguntas en esta categoria</div>';
        return;
      }

      container.innerHTML = filtered.map(f => `
        <div class="faq-item" data-id="${f.id}">
          <div class="faq-question" onclick="toggleFaq(${f.id})">
            <span>${escapeHtml(f.question)}</span>
            <span class="faq-arrow">&#x25BC;</span>
          </div>
          <div class="faq-answer">
            <div class="faq-answer-content">${f.answerHtml || escapeHtml(f.answer)}</div>
          </div>
        </div>
      `).join('');
    }

    function toggleFaq(id) {
      const item = document.querySelector(`.faq-item[data-id="${id}"]`);
      if (item) {
        item.classList.toggle('open');
      }
    }

    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchQuery = e.target.value.trim();
      renderFaqs();
    });

    loadFaqs();
  </script>
</body>
</html>
